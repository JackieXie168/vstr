<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>c2html for: ex_cat.c</title>
    <link rel="stylesheet" type="text/css" href="f_c.css">
  </head>
  <body>
     <h1>ex_cat.c</h1>
<pre class="c2html">
<span class="comment">/* This is a _simple_ cat program, no command line options. And no use of mmap.
 * Reads from stdin if no args are given.
 *
 * This shows how to use the Vstr library at it's simpelest,
 * for easy and fast IO. Note however that all needed error detection is
 * included.
 *
 * This file is more commented than normal code, so as to make it easy to follow
 * while knowing almost nothing about Vstr or Linux IO programming.
 */</span>
#<span class="cppinclude">include</span> <span class="str">"ex_utils.h"</span>

<span class="comment">/*  Keep reading on the file descriptor until there is no more data (ERR_EOF)
 * abort if there is an error reading or writing */</span>
<span class="static">static</span> <span class="void">void</span> ex_cat_read_fd_write_stdout(<span class="vstrbase">Vstr_base</span> *s1, <span class="int">int</span> fd)
{
  <span class="while">while</span> (<span class="true">TRUE</span>)
  {
    <span class="int">int</span> io_w_state = IO_OK;
    <span class="int">int</span> io_r_state = io_get(s1, fd);

    <span class="if">if</span> (io_r_state == IO_EOF)
      <span class="break">break</span>;
    
    io_w_state = io_put(s1, 1);

    io_limit(io_r_state, fd, io_w_state, 1, s1);    
  }
}

<span class="int">int</span> main(<span class="int">int</span> argc, <span class="char">char</span> *argv[])
{ <span class="comment">/* This is "cat", without any command line options */</span>
  
  <span class="vstrbase">Vstr_base</span> *s1 = ex_init(<span class="null">NULL</span>); <span class="comment">/* init the library etc. */</span>
  <span class="int">int</span> count = 1; <span class="comment">/* skip the program name */</span>

  <span class="comment">/* if no arguments are given just do stdin to stdout */</span>
  <span class="if">if</span> (count &gt;= argc)
  {
    io_fd_set_o_nonblock(<span class="stdin">STDIN_FILENO</span>);
    ex_cat_read_fd_write_stdout(s1, <span class="stdin">STDIN_FILENO</span>);
  }

  
  <span class="comment">/* loop through all arguments, open the file specified
   * and do the read/write loop */</span>
  <span class="while">while</span> (count &lt; argc)
  {
    <span class="int">int</span> fd = io_open(argv[count]);

    ex_cat_read_fd_write_stdout(s1, fd);

    <span class="if">if</span> (close(fd) == <span class="numm1">-1</span>)
      <span class="warn">warn</span>(<span class="str">"close(%s)"</span>, argv[count]);

    ++count;
  }

  <span class="comment">/* output all remaining data */</span>
  io_put_all(s1, <span class="stdout">STDOUT_FILENO</span>);

  <span class="exit">exit</span> (ex_exit(s1, <span class="null">NULL</span>));
}
</pre>
<!-- C to html convertion of ex_cat.c -->
<!--   done on Thu May 13 03:35:33 2004 -->
<!--   done by ex_highlight -->

  </body>
</html>

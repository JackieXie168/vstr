<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>c2html for: ex_hello_world_x.c</title>
    <link rel="stylesheet" type="text/css" href="f_c.css">
  </head>
  <body>
     <h1>ex_hello_world_x.c</h1>
<pre class="c2html">
<span class="comment">/* hello world - multiple pieces of data, includes substitution and
 *               inserting data into the middle of a string */</span>

#<span class="cppinclude">include</span> <span class="str">"ex_hello_world.h"</span> <span class="comment">/* helper functions */</span>

<span class="int">int</span> main(<span class="void">void</span>)
{
  <span class="vstrbase">Vstr_base</span> *s1 = hw_init();
  Vstr_ref *ref = <span class="null">NULL</span>;

  vstr_add_cstr_ptr(s1, s1-&gt;len, <span class="str">"Hello"</span>);

  vstr_add_rep_chr(s1, s1-&gt;len, <span class="chr">'W'</span>, 5); <span class="comment">/* add "WWWWWW" */</span>

  <span class="if">if</span> (s1-&gt;conf-&gt;malloc_bad)
    <span class="errno">errno</span> = ENOMEM, <span class="err">err</span>(<span class="exitfail">EXIT_FAILURE</span>, <span class="str">"Add string data"</span>);

  <span class="comment">/* substitute an 'o' for a 'W' */</span>
  <span class="if">if</span> (!vstr_sub_rep_chr(s1, strlen(<span class="str">"HelloWW"</span>), 1, <span class="chr">'o'</span>, 1))
    <span class="errno">errno</span> = ENOMEM, <span class="err">err</span>(<span class="exitfail">EXIT_FAILURE</span>, <span class="str">"Substitute string data"</span>);

  <span class="comment">/* substitute "WWW" for a "rld\n" -- */</span>
  <span class="if">if</span> (!vstr_sub_cstr_buf(s1, strlen(<span class="str">"HelloWoW"</span>), strlen(<span class="str">"WWW"</span>), <span class="str">"rld\n"</span>))
    <span class="errno">errno</span> = ENOMEM, <span class="err">err</span>(<span class="exitfail">EXIT_FAILURE</span>, <span class="str">"Substitute string data"</span>);

  <span class="if">if</span> (!(ref = vstr_ref_make_ptr((<span class="char">char</span> *)<span class="str">"XYZ "</span>, vstr_ref_cb_free_ref)))
    <span class="errno">errno</span> = ENOMEM, <span class="err">err</span>(<span class="exitfail">EXIT_FAILURE</span>, <span class="str">"Create data reference"</span>);
  <span class="comment">/* now ref-&gt;ptr is "XYZ " */</span>

  <span class="comment">/* add space after "Hello", by skipping "XYZ" in reference */</span>
  vstr_add_ref(s1, strlen(<span class="str">"Hello"</span>), ref, strlen(<span class="str">"XYZ"</span>), strlen(<span class="str">" "</span>));

  vstr_ref_del(ref); <span class="comment">/* delete our reference to the Vstr_ref */</span>

  <span class="if">if</span> (s1-&gt;conf-&gt;malloc_bad)
    <span class="errno">errno</span> = ENOMEM, <span class="err">err</span>(<span class="exitfail">EXIT_FAILURE</span>, <span class="str">"Add string data"</span>);

  <span class="while">while</span> (io_put(s1, <span class="stdout">STDOUT_FILENO</span>) != IO_NONE) {}

  <span class="exit">exit</span> (hw_exit(s1));
}
</pre>
<!-- C to html convertion of ex_hello_world_x.c -->
<!--   done on Sun May  9 02:29:53 2004
 -->
<!--   done by ex_highlight -->

  </body>
</html>
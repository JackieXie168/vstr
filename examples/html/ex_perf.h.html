<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>c2html for: ex_perf.h</title>
    <link rel="stylesheet" type="text/css" href="f_c.css">
  </head>
  <body>
     <h1>ex_perf.h</h1>
<pre class="c2html">
#<span class="cppifndef">ifndef</span> EX_PERF_H
#<span class="cppdefine">define</span> EX_PERF_H 1

#<span class="cppinclude">include</span> &lt;sys/time.h&gt; <span class="comment">/* gettimeofday */</span>
#<span class="cppinclude">include</span> &lt;malloc.h&gt; <span class="comment">/* mallinfo */</span>

#<span class="cppdefine">define</span> TST_HDR_BEG() \
  vstr_add_fmt(out, out-&gt;len, \
               <span class="str">"+${rep_chr:%c%zu}"</span> \
               <span class="str">"+${rep_chr:%c%zu}"</span> \
               <span class="str">"+${rep_chr:%c%zu}+\n"</span> \
               <span class="str">"| %34s | %15s | %16s |\n"</span> \
               <span class="str">"+${rep_chr:%c%zu}"</span> \
               <span class="str">"+${rep_chr:%c%zu}"</span> \
               <span class="str">"+${rep_chr:%c%zu}+\n"</span>, \
               <span class="chr">'='</span>, 18 + 18, <span class="chr">'='</span>, 17, <span class="chr">'='</span>, 18, \
               <span class="str">"Name"</span>, <span class="str">"Speed"</span>, <span class="str">"Memory"</span>, \
               <span class="chr">'-'</span>, 18 + 18, <span class="chr">'-'</span>, 17, <span class="chr">'-'</span>, 18)

#<span class="cppdefine">define</span> TST_HDR_END() \
  vstr_add_fmt(out, out-&gt;len, \
               <span class="str">"+${rep_chr:%c%zu}"</span> \
               <span class="str">"+${rep_chr:%c%zu}"</span> \
               <span class="str">"+${rep_chr:%c%zu}+\n"</span>, \
               <span class="chr">'-'</span>, 18 + 18, <span class="chr">'-'</span>, 17, <span class="chr">'-'</span>, 18)

#<span class="cppdefine">define</span> TST_BEG(x, y) <span class="do">do</span> { \
		struct mallinfo mal_beg; \
		struct mallinfo mal_end; \
		struct timeval tv_beg; \
		struct timeval tv_end; \
		unsigned <span class="int">int</span> test_for = (y); \
                <span class="unsigned">unsigned</span> <span class="int">int</span> tst_count = <span class="num0">0</span>; \
                 \
                mal_beg = mallinfo(); <span class="comment">/* warning */</span> \
		gettimeofday(&amp;tv_beg, <span class="null">NULL</span>); \
		 \
		while (tst_count &lt; test_for) \
		{ \
			unsigned <span class="char">char</span> buf_out[x]


#<span class="cppdefine">define</span> TST__END() \
                        ++tst_count; \
		} \
                 \
		gettimeofday(&amp;tv_end, <span class="null">NULL</span>); \
                <span class="if">if</span> (tv_end.tv_usec &lt; tv_beg.tv_usec) \
                { \
                  tv_end.tv_usec += 1000 * 1000; \
                  tv_end.tv_sec  -= 1; \
                } \
                mal_end = mallinfo(); <span class="comment">/* warning */</span>

#<span class="cppdefine">define</span> TST_END(name) TST__END() \
		vstr_add_fmt(out, out-&gt;len, \
                             <span class="str">"| %-34s | %'8lu.%06lu | %'16lu |\n"</span>, \
                             (name), \
		             tv_end.tv_sec  - tv_beg.tv_sec, \
                             tv_end.tv_usec - tv_beg.tv_usec, \
                             (<span class="unsigned">unsigned</span> <span class="long">long</span>) \
                             (mal_end.uordblks - mal_beg.uordblks) + \
                             (mal_end.hblkhd - mal_beg.hblkhd)); \
	} <span class="while">while</span> (<span class="num0">0</span>)

#<span class="cppdefine">define</span> TST_CALC_END(name) TST__END() \
  vstr_add_fmt(out, out-&gt;len, \
               <span class="str">"%s %u %u %u %u %lu.%06lu %ld %ld\n"</span>, (name), \
               len, num, sz, extra, \
               tv_end.tv_sec  - tv_beg.tv_sec, \
               tv_end.tv_usec - tv_beg.tv_usec, \
               ((<span class="long">long</span>)mal_end.uordblks - (<span class="long">long</span>)mal_beg.uordblks) + \
               ((<span class="long">long</span>)mal_end.hblkhd - (<span class="long">long</span>)mal_beg.hblkhd), \
               ((<span class="long">long</span>)mal_end.fordblks - (<span class="long">long</span>)mal_beg.fordblks)); \
	} <span class="while">while</span> (<span class="num0">0</span>)



#<span class="cppendif">endif</span>

</pre>
<!-- C to html convertion of ex_perf.h -->
<!--   done on Fri May 14 06:15:25 2004 -->
<!--   done by ex_highlight -->

  </body>
</html>
